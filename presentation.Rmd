---
title: "Data Analysis Revolutionizing Journalism"
subtitle: "ETC5543 Internship Presentation"  
author: 
  - "Author: Ambalika Gupta"
  - "Supervisor: James Goldie, 360info"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    ratio: '16:9'
    lib_dir: libs
---

```{r, include = FALSE}
current_file <- knitr::current_input()
basename <- gsub(".Rmd$", "", current_file)

knitr::opts_chunk$set(
  fig.path = sprintf("images/%s/", basename),
  fig.width = 6,
  fig.height = 4,
  out.width = "100%",
  fig.align = "center",
  fig.retina = 3,
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  cache = FALSE,
  cache.path = "cache/"
)
```


```{r xaringan-themer, warning=FALSE, include=FALSE}
library(xaringanthemer)
library(xaringanExtra)
style_mono_light(
  base_color = "#23395b",
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Josefin Sans"),
  code_font_google   = google_font("Fira Mono")
)
```

```{r package, include=FALSE}

library(readr)
library(janitor)
library(tidyverse)
library(plotly)
library(stringr)
library(ggplot2)
library(sf)
library(rnaturalearthdata)
library(rnaturalearth)
library(ggpattern)
library(colorspace)
library(scales)
library(themes360info)
library(rio)
library(readxl)
library(ggtext)

```


# Organisation: 360info

## Background

360info is an open access global information agency that addresses the world's biggest challenges and offers practical and research-based solutions.

### Role

Contribute to a Special Report made up of 5-10 articles looking at different aspects of, or solutions to, the problem in the following ways:

-   Exploratory Data Analysis
-   Data Wrangling support
-   Graphics

---

```{r data, include=FALSE}

w_18 <- read_csv("data/child_marriage/w_18.csv")

w_18 <- w_18 %>% 
  select(geoAreaCode, geoAreaName, parentCode, parentName, ISO3, latest_value)

law_2 <- read_csv("data/child_marriage/law_2.csv")

cmf <- law_2 %>% 
  left_join(w_18, by = c("Code" = "ISO3"))

countries <- ne_countries(returnclass = "sf", scale = "medium")

cmf1 <- countries %>% 
  select(iso_a3) %>% 
  left_join(cmf, by = c("iso_a3" = "Code")) %>% 
  drop_na(Law)

cmf1 %>%
  mutate(
    LawStr = case_when(
      Law == 0    ~ "Prohibited",
      Law == 0.25 ~
        "Prohibited, but encouraged\nby some customary or\ntraditional laws",
      Law == 0.5  ~ "Prohibited, but with legal\nexceptions around consent or\nsome groups of women",
      Law == 0.75 ~ "Allowed",
      Law == 1    ~ "Allowed for girls only")) ->
  cmf1


```

```{r include=FALSE}

combined_map <- ggplot() +
  geom_sf(data = countries, fill = "grey", colour = "#00000066", size = 0.25) +
  geom_sf_pattern(
    mapping = aes(
      pattern_spacing = LawStr,
      pattern_density = LawStr,
      pattern_angle   = LawStr,
      pattern         = LawStr,
      fill = latest_value
    ),
    data = cmf1,
    stat = "sf",
    position = "identity",
    colour = "#00000066",
    size = 0.25,
    pattern_aspect_ratio = 1.8,
    pattern_fill = "black",
    pattern_alpha = 0.3
  ) +
  scale_pattern_density_discrete(range = c(0.005, 0.3), name = "Legality") +
  scale_pattern_spacing_discrete(range = c(0.005, 0.03), name = "Legality") +
  scale_pattern_angle_discrete(range = c(0, 45), name = "Legality") +
  scale_pattern_discrete(name = "Legality") +
  scale_fill_fermenter(name = "Rate", palette = "YlOrBr", direction = 1,
    na.value = "grey",
    labels = scales::label_number(suffix = "%")) +
  labs(
    title = "CHILD MARRIAGE",
    subtitle = "% women aged 20-24 married before 18 (average 2005-2020)\nand the legal status of child marriage",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNStats, World Bank via Our World in Data",
      sep = "<br>"
    )
  ) +
  theme_360() +
  theme(
    # legend.position = "top",
    legend.position = c(0.1625, 0.35),
    legend.direction = "vertical",
    legend.key.width = unit(0.5, "cm"),
    legend.title = element_text(size = rel(0.55)),
    legend.text = element_text(size = rel(0.4)),
    legend.box = "horizontal",
    legend.box.background = element_rect(fill = "#ffffff99", colour = NA),
    panel.grid = element_blank(),
    plot.margin = margin()
  )
  
save_360plot(combined_map, file.path("images", "combined_map.png"), retina = 4,
  shape = "sdtv-landscape")

```

### Topic 1: Child Marriage during Covid-19
Due to Covid-19 about **9 million** more girls were at risk of child marriage.
.right-column[
```{r echo = FALSE, fig.align="center", warning=FALSE, message=FALSE, echo=FALSE, out.height="450px", out.width="680px"}
knitr::include_graphics(file.path("images", "combined_map.png"))
```

]
.left-column[
**Methodology**
* ggpattern package
* rnaturalearth package
* QGIS software

**Limitations:**
+ Latest Data for child marriage rate from 2005 - 2022.
+ Missing Data for many countries during Covid-19 period
]

---
### Topic 1: Child Marriage during Covid-19
```{r echo=FALSE, warning=FALSE, message= FALSE, out.height="375px", out.width="600px"}

child_marriage <- read_csv("data/child_marriage/child_marriage.csv")

child_covid <- child_marriage %>%
  clean_names()

child_covid <- child_covid %>%
  filter(time_period_time_period == 2021) %>%
  filter(!geographic_area %in% c("Fiji", "Denmark", "Singapore", "Least developed countries", "World"))

ggplot(data = child_covid, aes(
  y = reorder(geographic_area, obs_value_observation_value),
  x = obs_value_observation_value
)) +
  geom_bar(fill = "steelblue",
           stat = "identity") +
  geom_text(
    aes(label = obs_value_observation_value),
    hjust = 1.5,
    color = "black",
    size = 4
  ) +
  scale_y_discrete(labels = label_wrap(15)) +
  labs(title = paste("Child Marriage Rate in Sub Continental Region", "during Covid-19", sep ="\n"),
       caption = "UNICEF Data") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1,
  ),
  legend.position = "none") +
  xlab("Child Marriage Rate") +
  ylab("Region") +
  theme_minimal()

```

**Observations:**
+ In Eastern and Southern African countries like Ethiopia, Mozambique, Uganda, Congo and Zambia have the highest rate of child marriage.

+ Possible reasons: School closures, Economic Distress, Service Disruptions, Parental Deaths, Lack of access to basic ammenities.
*Source: UNICEF Press Release*


```{r include=FALSE}

whrfactor <- import_list("data/healtheconomics/2015_a.xlsx" , rbind=TRUE)

whrfactor <- whrfactor %>% 
  select(-`_file`)

whrfactor <- whrfactor %>% 
  pivot_longer(
    cols = 2:9,
    names_to = "factor",
    values_to = "value"
  )

whrfactor <- whrfactor %>% 
  mutate(factor = recode(factor,
    "GDP_per_capita" = "GDP Per Capita",
    "social_support" = "Social Support",
    "life_expectancy" = "Life Expectancy",
    "freedom" = "Freedom",
    "generosity" = "Generosity",
    "corruption_view" = "Corruption"
  ))

whrfac <- whrfactor %>%
  filter(factor != c("residual", "score"))

indonesiawhr <- whrfac %>%
  filter(country == "Australia")

indonesiascore <- whrfactor %>%
  filter(factor == "score", country == "Australia")

wellbeing <-
  ggplot(data = indonesiawhr, aes(fill = factor, x = year, y = value)) +
  scale_x_continuous(n.breaks = 8) +
  scale_fill_manual(
    values = c("#7fc97f",
               "#beaed4",
               "#fdc086",
               "#ffff99",
               "#386cb0",
               "#000000",
               "#f0027f"
    ),
    name = "Happiness Factors"
  ) +
  geom_bar(position = "stack", stat = "identity") +
  labs(title = "World Happiness Score : Factor composition", y = "Index/Score") +
  theme_360() +
  theme(legend.position = "bottom",
        axis.title.x = element_blank()) +
  geom_line(data = indonesiascore, aes(x = year, y = value)) +
  geom_point(data = indonesiascore)

save_360plot(wellbeing, file.path("images", "happiness.png"), shape = "sdtv-landscape")
```

```{r include=FALSE}

# Reading HDI data

hdi <- read_csv("data/healtheconomics/hdi_timeseries.csv")

hdi <- hdi %>%
  pivot_longer(cols = 6:37,
               names_to = "year",
               values_to = "HDI")

hdi <- hdi %>%
  select(c(-region,-hdicode,-hdi_rank_2021)) %>%
  mutate(year = str_remove_all(year, "hdi_")) %>%
  mutate(year = as.numeric(year))

# Reading WHR(World Happiness Record) data

whr <- read_excel("data/healtheconomics/wellbeing-otherfactos.xls")

whr <- whr %>%
  clean_names() %>%
  mutate(WHR = life_ladder / 10)

# Comparison data

comparison1 <- whr %>%
  left_join(hdi, by = c("country_name" = "country", "year")) %>%
  select(country_name, year, 13:15)

comparison <- comparison1 %>%
  pivot_longer(cols = c(3, 5),
               names_to = "organisation",
               values_to = "score")

comparison$organisation[comparison$organisation == "WHR"] <-
  "Life Ladder Score"
comparison$organisation[comparison$organisation == "HDI"] <-
  "Human Development Index"

filtered <- comparison %>%
  filter(country_name %in% c(
    "Australia",
    "Afghanistan",
    "India",
    "Pakistan"))


```

```{r include=FALSE}

country_comparison_plot <- ggplot(data = filtered,
       aes(x = year,
           y = score,
           color = organisation)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::label_percent()) +
  scale_color_manual(values = c(
    "Human Development Index" = "#d73027",
    "Life Ladder Score" = "#4575b4")) +
  labs(
    title = toupper("Measuring Wellbeing"),
    subtitle = paste(
      "The UN's **<span style=\"color:#d73027\">Human Development Index</span>** is a leading indicator for measuring a countryâ€™s progress",
      "and includes life expectancy and income per capita. But the **<span style=\"color:#4575b4\">Life Ladder Score</span>**, measured by",
      "the annual World Happiness Report, asks survey respondents to rate their lives.",
      "It often tells a very different story.",
      sep = "<br>"),
    y = "Score",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNDP & World Happiness Report",
      sep = "<br>"
    )
  ) +
  facet_wrap(~ country_name,
               ncol = 2) +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    axis.title.x = element_blank(),
    legend.title = element_blank(),
    legend.key.width = unit(1, "cm"),
    panel.background = element_rect(fill = "#fcfcfc", colour = NA),
    panel.spacing.x = unit(1, "cm"),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    strip.text = element_text(face = "bold"),
    plot.margin = margin(0.5, 0.5, 1, 0.5, "cm"),
    plot.subtitle = element_markdown(
      family = "Body 360info", face = "plain", color = "black")
  )

save_360plot(country_comparison_plot, file.path("images", "wellbeing.png"), shape = "sdtv-landscape")

```

---

### Topic 2: The Economics of Well-Being: Can Money buy Happiness?ðŸ˜Š

Progress of an economy cannot only be captured in terms of GDP, but should also be measured by metrics of health, education, and freedom.

```{r echo = FALSE, fig.align="center", warning=FALSE, message=FALSE, echo=FALSE, out.height="435px", out.width="625px"}

knitr::include_graphics(file.path("images", "happiness.png"))

```

---

### Topic 2: The Economics of Well-Being

```{r echo = FALSE, fig.align="center", warning=FALSE, message=FALSE, echo=FALSE, out.height="425px", out.width="625px"}

knitr::include_graphics(file.path("images", "wellbeing.png"))

```

**Observations**

ðŸ’¡ Nordic Countries like Finland, Sweden, Netherlands have highest happiness score
ðŸ’¡ Afghanistan has the lowest happiness score for 2022. Followed by other South Asian and African countries.
*Source: UNDP & World Happiness Report* 


---

class: center, middle

# Thank you for Watching!

```{r echo = FALSE, fig.align="center", warning=FALSE, message=FALSE, echo=FALSE, out.height="400px", out.width="500px"}

knitr::include_graphics(file.path("images", "minion.jpg"))

```



