---
title: "healthecon"
author: "Ambalika"
date: sys.date
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r package}

library(readr)
library(readxl)
library(janitor)
library(tidyverse)
library(rnaturalearth)
library(ggplot2)
library(plotly)
library(themes360info)
library(rio)
```

```{r readdata}

# Reading HDI data

hdi <- read_csv("data/healtheconomics/hdi_timeseries.csv")

hdi <- hdi %>%
  pivot_longer(
    cols = 6:37,
    names_to = "year",
    values_to = "HDI"
  )

hdi <- hdi %>%
  select(-c(region, hdicode, hdi_rank_2021)) %>%
  pivot_longer(starts_with("hdi_"), names_to = "year", values_to = "hdi") |>
  mutate(year = str_remove_all(year, "hdi_")) %>%
  mutate(year = as.numeric(year)) %>%
  filter(year > 2014)

# Reading WHR(World Happiness Record) data

whr <- read_excel("data/healtheconomics/wellbeing-otherfactos.xls")

whr <- whr %>%
  clean_names() %>% 
  mutate(WHR = life_ladder / 10)

# Comparison data
# james - i'm assuming you're pivoting the two scores longer here?
comparison <- whr %>%
  left_join(hdi, by = c("country_name" = "country", "year")) %>%
  select(country_name, year, WHR, iso3, hdi) %>%
  pivot_longer(
    cols = c(WHR, hdi),
    names_to = "organisation",
    values_to = "score"
  ) %>%
  mutate(organisation = recode(organisation,
    "WHR" = "Happiness Score",
    "HDI" = "Human Development Index"
  ))

```

```{r bycountries}

dir.create("out/by-country", recursive = TRUE, showWarnings = FALSE)

plot_scores <- function(df) {
  
  country_name <- df$country_name[1]

  country_plot <- ggplot(df) +
    aes(x = year, y = score, color = organisation) +
    geom_line(size = 1) +
    geom_point(size = 2) +
    labs(
      title = paste("WELLBEING ECONOMICS:", toupper(country_name)),
      subtitle = "Comparing Human Development Index with World Happiness Score",
      color = "Organisation",
      x = "Year",
      y = "Score",
      caption = paste(
        "**CHART:** Ambalika Gupta & James Goldie, 360info",
        "**DATA:** UNDP & World Happiness Report",
        sep = "<br>"
      )
    ) +
    theme_360() +
    theme(
      legend.position = "top",
      legend.direction = "horizontal",
      legend.key.width = unit(1, "cm")
    )

  save_360plot(
    country_plot,
    file.path("out", "by-country", paste0(country_name, ".png")),
    shape = "sdtv-landscape")
  save_360plot(
    country_plot,
    file.path("out", "by-country", paste0(country_name, ".svg")),
    shape = "sdtv-landscape")
}

# plot each country
comparison %>%
  group_split(country_name, .keep = TRUE) %>%
  walk(plot_scores)

```

```{r nz}

# New Zealand

nz <- comparison %>%
  filter(country_name == "New Zealand")

ggplot(
  data = nz,
  aes(
    x = year,
    y = score,
    color = organisation
  )
) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "WELLBEING ECONOMICS: NEW ZEALAND",
    subtitle = "Comparing Human Development Index with World Happiness Score",
    color = "Organisation",
    x = "Year",
    y = "Score",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNDP & World Happiness Report",
      sep = "\n"
    )
  ) +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.key.width = unit(1, "cm")
  )

theme_360()
```


```{r india}

# India

india <- comparison %>%
  filter(country_name == "India")

ggplot(
  data = india,
  aes(
    x = year,
    y = score,
    color = organisation
  )
) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "WELLBEING ECONOMICS: INDIA",
    subtitle = "Comparing Human Development Index with World Happiness Score",
    color = "Organisation",
    x = "Year",
    y = "Score",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNDP & World Happiness Report",
      sep = "\n"
    )
  ) +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.key.width = unit(1, "cm")
  )
```

```{r paki}

# Pakistan

pakistan <- comparison %>%
  filter(country_name == "Pakistan")

ggplot(
  data = pakistan,
  aes(
    x = year,
    y = score,
    color = organisation
  )
) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "WELLBEING ECONOMICS: PAKISTAN",
    subtitle = "Comparing Human Development Index with World Happiness Score",
    color = "Organisation",
    x = "Year",
    y = "Score",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNDP & World Happiness Report",
      sep = "\n"
    )
  ) +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.key.width = unit(1, "cm")
  )
```

```{r indonesia}

# Indonesia

indonesia <- comparison %>%
  filter(country_name == "Indonesia")

ggplot(
  data = indonesia,
  aes(
    x = year,
    y = score,
    color = organisation
  )
) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "Wellbeing Economics: Indonesia",
    subtitle = "Comparing Human Development Index with World Happiness Score",
    color = "Organisation",
    x = "Year",
    y = "Score",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNDP & World Happiness Report",
      sep = "\n"
    )
  ) +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.key.width = unit(1, "cm")
  )
```

```{r thai}

# Thailand

thailand <- comparison %>%
  filter(country_name == "Thailand")

ggplot(
  data = thailand,
  aes(
    x = year,
    y = score,
    color = organisation
  )
) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "WELLBEING ECONOMICS: THAILAND",
    subtitle = "Comparing Human Development Index with World Happiness Score",
    color = "Organisation",
    x = "Year",
    y = "Score",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNDP & World Happiness Report",
      sep = "\n"
    )
  ) +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.key.width = unit(1, "cm")
  )
```

```{r sgp}

# Singapore

singapore <- comparison %>%
  filter(country_name == "Singapore")

ggplot(
  data = singapore,
  aes(
    x = year,
    y = score,
    color = organisation
  )
) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "WELLBEING ECONOMICS: SINGAPORE",
    subtitle = "Comparing Human Development Index with World Happiness Score",
    color = "Organisation",
    x = "Year",
    y = "Score",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNDP & World Happiness Report",
      sep = "\n"
    )
  ) +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.key.width = unit(1, "cm")
  )
```

```{r myanmar}

# Myanmar

myanmar <- comparison %>%
  filter(country_name == "Myanmar")

ggplot(
  data = myanmar,
  aes(
    x = year,
    y = score,
    color = organisation
  )
) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "WELLBEING ECONOMICS: MYANMAR",
    subtitle = "Comparing Human Development Index with World Happiness Score",
    color = "Organisation",
    x = "Year",
    y = "Score",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNDP & World Happiness Report",
      sep = "\n"
    )
  ) +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.key.width = unit(1, "cm")
  )
```

```{r aus}

# Australia

aus <- comparison %>%
  filter(country_name == "Australia")

ggplot(
  data = aus,
  aes(
    x = year,
    y = score,
    color = organisation
  )
) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "WELLBEING ECONOMICS: AUSTRALIA",
    subtitle = "Comparing Human Development Index with World Happiness Score",
    color = "Organisation",
    x = "Year",
    y = "Score",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNDP & World Happiness Report",
      sep = "\n"
    )
  ) +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.key.width = unit(1, "cm")
  )
```








































