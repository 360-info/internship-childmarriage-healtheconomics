---
title: "child_marriage"
author: "Ambalika"
date: "2023-03-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r package}

library(readr)
library(tidyverse)
library(ggplot2)
library(sf)
library(rnaturalearthdata)
library(rnaturalearth)
library(colorspace)
library(themes360info)

```

```{r}

w_18 <- read_csv("data/child_marriage/w_18.csv")

w_18 <- w_18 %>% 
  select(geoAreaCode, geoAreaName, parentCode, parentName, ISO3, latest_value)

law_2 <- read_csv("data/child_marriage/law_2.csv")

cmf <- law_2 %>% 
  left_join(w_18, by = c("Code" = "ISO3"))

countries <- ne_countries(returnclass = "sf", scale = "medium")

cmf1 <- countries %>% 
  select(iso_a3) %>% 
  left_join(cmf, by = c("iso_a3" = "Code")) %>% 
  drop_na(Law)

cmf1 %>%
  mutate(
    LawStr = case_when(
      Law == 0 ~ "Prohibited",
      Law == 0.25 ~ "Prohibited with legal exceptions",
      Law == 0.5 ~  "Prohibited with legal exceptions for girls",
      Law == 0.75 ~ "Allowed",
      Law == 1 ~ "Allowed for girls")) ->
  cmf1


```


```{r}
rate_map <- ggplot() +
 geom_sf(data = countries, fill = "grey", colour = "black") +
  geom_sf(
    mapping = aes(fill = latest_value),
    data = cmf1,
    stat = "sf",
    position = "identity",
    colour = "black",
    expand = TRUE
    ) +
  scale_fill_fermenter(
    name = NULL,
    palette = "YlOrBr",
    direction = 1,
    labels = scales::label_number(suffix = "%"),
    na.value = "grey") + 
  labs(
    title = "CHILD MARRIAGE",
    subtitle = "% women aged 20-24 married before 18 (average 2005-2020)",
    caption = paste(
      "**CHART:** Ambalika Gupta & James Goldie, 360info",
      "**DATA:** UNStats",
      sep = "<br>")) +
  #coord_sf(crs = "ESRI:54012") +
  theme_360() +
  theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.key.width = unit(2, "cm"),
    panel.grid = element_blank()
  )

save_360plot(rate_map, "rate_map.png", retina = 4, shape = "sdtv-landscape")
```
